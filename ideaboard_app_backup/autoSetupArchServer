#!/usr/bin/env bash
set -e

PROJECT_DIR="$HOME/git/ideaboard_masterplan/ideaboard_app"
SESSION="ideaboard"

# Alte Session beenden (falls vorhanden)
tmux has-session -t "$SESSION" 2>/dev/null && tmux kill-session -t "$SESSION"

# Neue Session starten
tmux new-session -d -s "$SESSION" -c "$PROJECT_DIR"

# Fenster 1: Docker
tmux rename-window -t "$SESSION:0" "docker"
tmux send-keys -t "$SESSION:0" "docker-compose up" C-m

# Fenster 2: PostgreSQL
tmux new-window -t "$SESSION" -n "postgres" -c "$PROJECT_DIR"
tmux send-keys -t "$SESSION:postgres" \
  "psql postgresql://root:root@127.0.0.1:5432/idea" C-m

# Fenster 3: Next.js Dev Server
tmux new-window -t "$SESSION" -n "nextjs" -c "$PROJECT_DIR"
tmux send-keys -t "$SESSION:nextjs" \
  "DATABASE_URL=postgresql://root:root@127.0.0.1:5432/idea npm run dev" C-m

# Attach
tmux attach -t "$SESSION"
