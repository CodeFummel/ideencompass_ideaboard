generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model File {
  id     Int    @id @default(autoincrement())
  idea   Idea   @relation(fields: [ideaId], references: [id])
  ideaId Int
  name   String
  data   String

  @@map("files")
}

model User {
  id            String     @id @unique
  name          String
  email         String     @unique
  emailVerified Boolean
  createdAt     DateTime
  updatedAt     DateTime
  userImage     String     @default("none")
  role          String     @default("user")
  banned        Boolean    @default(false)
  banReason     String?
  banExpires    Int?
  sessions      Session[]
  accounts      Account[]
  ideas         Idea[]
  likes         Like[]
  comments      Comment[]
  projects      Project[]
  polls         Poll[]
  reactions     Reaction[]
  votes         Vote[]

  @@map("users")
}

model Session {
  id        String   @id @unique
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  token     String   @unique
  ipAddress String
  userAgent String
  expiresAt DateTime
  createdAt DateTime
  updatedAt DateTime

  @@map("sessions")
}

model Account {
  id         String   @id @unique
  user       User     @relation(fields: [userId], references: [id])
  userId     String
  accountId  String
  providerId String
  password   String
  createdAt  DateTime
  updatedAt  DateTime

  @@map("accounts")
}

model Verification {
  id         String   @id @unique
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime
  updatedAt  DateTime

  @@map("verifications")
}

model Idea {
  id         Int       @id @default(autoincrement())
  title      String
  category   String
  tags       String[]
  body       String
  author     User      @relation(fields: [authorId], references: [id])
  authorId   String
  authorName String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @default(now()) @updatedAt
  files      File[]
  likes      Like[]
  comments   Comment[]
  projects   Project[]

  @@map("ideas")
}

model Like {
  author    User     @relation(fields: [authorId], references: [id])
  authorId  String
  idea      Idea     @relation(fields: [likedIdea], references: [id])
  createdAt DateTime @default(now())
  likedIdea Int

  @@id(name: "likeId", [authorId, likedIdea])
  @@map("likes")
}

model Comment {
  id          Int        @id @default(autoincrement())
  content     String
  createdAt   DateTime   @default(now())
  idea        Idea       @relation(fields: [commentedId], references: [id])
  commentedId Int
  author      User       @relation(fields: [authorId], references: [id])
  authorId    String
  authorName  String
  reactions   Reaction[]

  @@map("comments")
}

model Reaction {
  id        Int     @id @default(autoincrement())
  comment   Comment @relation(fields: [commentId], references: [id])
  author    User    @relation(fields: [authorId], references: [id])
  authorId  String
  commentId Int
  emoji     Int

  @@map("reactions")
}

model Project {
  id         Int      @id @default(autoincrement())
  idea       Idea     @relation(fields: [parentIdea], references: [id])
  parentIdea Int
  title      String
  body       String
  progress   Int      @default(0)
  status     String   @default("concept")
  manager    User     @relation(fields: [managerId], references: [id])
  managerId  String
  createdAt  DateTime @default(now())

  @@map("projects")
}

model Poll {
  id         Int      @id @default(autoincrement())
  createdAt  DateTime @default(now())
  closeDate  DateTime
  title      String
  body       String
  author     User     @relation(fields: [authorId], references: [id])
  authorId   String
  authorName String
  options    Option[]
  votes      Vote[]

  @@map("polls")
}

model Option {
  id      Int    @id @default(autoincrement())
  content String
  poll    Poll   @relation(fields: [pollId], references: [id])
  pollId  Int
  votes   Vote[]

  @@map("options")
}

model Vote {
  author      User   @relation(fields: [authorId], references: [id])
  authorId    String
  poll        Poll   @relation(fields: [votedPoll], references: [id])
  votedPoll   Int
  option      Option @relation(fields: [votedOption], references: [id])
  votedOption Int

  @@id(name: "voteId", [authorId, votedPoll])
  @@map("votes")
}
